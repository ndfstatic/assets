{"version":3,"sources":["webpack:///./src/views/product/Redirect.vue?116b","webpack:///./src/views/product/Redirect.vue?9c1e","webpack:///src/views/product/Redirect.vue","webpack:///./src/views/product/Redirect.vue?252d","webpack:///./src/views/product/Redirect.vue?557c"],"names":["render","_vm","this","_h","$createElement","_c","_self","directives","name","rawName","value","expression","staticClass","class","url","attrs","app","autoExchange","isApp","isIOS","_e","tryUsername","tryPwd","_v","_s","tryUrl","try_btn","style","errorMsg","staticRenderFns","component"],"mappings":"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","file":"static/js/chunk-b312140c.ddacf5e4.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Redirect.vue?vue&type=style&index=0&id=48970333&scoped=true&lang=scss&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Redirect.vue?vue&type=style&index=0&id=48970333&scoped=true&lang=scss&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],staticClass:\"product_redirect\",class:{url: !!_vm.url },attrs:{\"element-loading-text\":_vm.app.autoExchange ? '余额自动转入游戏中' : '加载中',\"element-loading-spinner\":\"el-icon-loading\",\"element-loading-background\":\"rgba(0, 0, 0, 0.8)\"}},[(_vm.url)?[(!_vm.app.isApp && _vm.app.isIOS)?_c('iframe',{staticClass:\"frame\",attrs:{\"src\":_vm.url,\"sandbox\":\"allow-same-origin allow-top-navigation allow-forms allow-scripts\"}}):_c('iframe',{staticClass:\"frame\",attrs:{\"src\":_vm.url}})]:_vm._e(),(_vm.tryUsername || _vm.tryPwd)?_c('div',{staticClass:\"try_text\"},[(_vm.tryUsername)?_c('p',[_vm._v(\"试玩用户名：\"+_vm._s(_vm.tryUsername))]):_vm._e(),(_vm.tryPwd)?_c('p',[_vm._v(\"试玩密码：\"+_vm._s(_vm.tryPwd))]):_vm._e(),_c('a',{attrs:{\"href\":_vm.tryUrl,\"target\":\"_blank\"}},[_c('el-button',{class:_vm.try_btn,style:({'padding-left': 20, 'padding-right': 20 }),attrs:{\"type\":\"primary\"}},[_vm._v(\"前往试玩\")])],1)]):_vm._e(),(_vm.errorMsg)?_c('div',{staticClass:\"error_msg\"},[_vm._v(\"\\n        \"+_vm._s(_vm.errorMsg)+\"\\n    \")]):_vm._e()],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div \n    v-loading=\"loading\" \n    :element-loading-text=\"app.autoExchange ? '余额自动转入游戏中' : '加载中'\"\n    element-loading-spinner=\"el-icon-loading\"\n    element-loading-background=\"rgba(0, 0, 0, 0.8)\"\n    class=\"product_redirect\" :class=\"{url: !!url }\">\n        <template v-if=\"url\">\n            <iframe :src=\"url\" v-if=\"!app.isApp && app.isIOS\" class=\"frame\" sandbox=\"allow-same-origin allow-top-navigation allow-forms allow-scripts\"></iframe>\n            <iframe :src=\"url\" v-else class=\"frame\"></iframe>\n        </template>\n        <div class=\"try_text\" v-if=\"tryUsername || tryPwd\">\n            <p v-if=\"tryUsername\">试玩用户名：{{ tryUsername }}</p>\n            <p v-if=\"tryPwd\">试玩密码：{{ tryPwd }}</p>\n            <a :href=\"tryUrl\" target=\"_blank\">\n              <el-button type=\"primary\" :class=\"try_btn\" :style=\"{'padding-left': 20, 'padding-right': 20 }\">前往试玩</el-button>\n            </a>\n        </div>\n        <div v-if=\"errorMsg\" class=\"error_msg\">\n            {{ errorMsg }}\n        </div>\n    </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\nimport request from '@/utils/request'\nimport { getUrl, getTryUrl, transferallout } from '@/api/product'\nimport { transfer  } from '@/api/user'\n\nexport default {\n    name: 'Product-Redirect',\n    components: {\n    },\n\n    data() {\n        return {\n            loading: false,\n            url: '',\n            errorMsg: '',\n            tryUsername: '',\n            tryPwd: '',\n            tryUrl: '',\n        }\n    },\n\n    computed: {\n\t\tapp() { return this.$store.getters.app },\n\t\tuser() { return this.$store.getters.user },\n\t\tproduct() { return this.$store.getters.product },\n        productId() { return this.$route.query.pid },\n        gameType() { return this.$route.query.gameType },\n        // isTest() { return this.$route.query.test == 'sy' },\n        filterProduct() {\n            const checkNavIsShow = (id) => {\n                let res = false;\n                this.product.navList.forEach(nav => {\n                    nav.list && nav.list.forEach(p => {\n                        if(p.id == id) {\n                            if(nav.is_show == 'Y') {\n                                res = true;\n                            } \n                        }\n                    })\n                })\n\n                return res;\n            }\n\n            const list = this.product.list.filter(item => {\n                return item.is_show == 'Y' && checkNavIsShow(item.id);\n            });\n\n            return list;\n        }\n    },\n\n    mounted() {\n        this.init()\n    },\n\n    methods: {\n        init() {\n            // this.url = 'http://xj-mbs.prdasbbwla1.com/m/zh-cn/sports?theme=default&sni=3txn4wen1fyjnzmiqjx2nppc';\n            // this.url = 'http://xj-mbs.uatasb.com/m/zh-cn/sports?theme=default&sni=ptmdq0mummp0waepyjb4fxuk';\n            // this.url = 'https://www.taobao.com/';\n            // window.location.href = 'http://xj-mbs.prdasbbwla1.com/m/zh-cn/sports?theme=default&sni=3txn4wen1fyjnzmiqjx2nppc';\n            // return ;\n            \n            if(this.user.roles.indexOf('user') > -1) {\n                if(this.app.autoExchange) {\n                    this.reloadBalance((hadExchange) => {\n                        if(hadExchange) {\n                            const product_ids = this.filterProduct.map(item => { return item.id }).join(',');\n                            this.$store.dispatch('productBalanceByAjax', { product_ids }).then(() => {\n                                this.getProductUrl();\n                            });\n                        }else {\n                            this.getProductUrl();\n                        }\n                    });\n                } else {\n                    this.getProductUrl();\n                }    \n            }else if(this.user.roles.indexOf('try') > -1) {\n                   this.getProductTryUrl();\n            }else {\n                this.$router.push({ path: '/auth/login' })\n                return ;\n            }\n\n            \n            // this.getProductUrl();\n        },\n\n        reloadBalance(callback) {\n            const product_ids = this.filterProduct.map(item => { return item.id }).join(',');\n            this.loading = true;\n            this.$store.dispatch('productBalanceByAjax', { product_ids }).then((json) => {\n                if(json.code == 200) {\n                    let idArr = [], total_money = 0;\n                    for(let id in json.list) {\n                        const money = Number(json.list[id].money);\n                        \n                        if(id != 0 && id != this.productId) {\n                            // 大于 0 则 回收\n                            if(money > 0) {\n                                idArr.push(id);\n                            }\n                        }\n\n                        if(id == 0) {\n                            total_money = money\n                        }\n                    }\n\n                    if(idArr.length) {\n                        const data = {\n                            type: 3,\n                            product_id: idArr.join(','),\n                        }\n\n                        transfer(data).then(json => {\n                            if (json.code == 200) {\n                                transferallout(this.productId).then(() => {\n                                    setTimeout(() => {\n                                        this.loading = false;\n                                        callback && callback(1);\n                                    }, 3000);     \n                                })\n                            } else {\n                                this.$message.error(json.info);\n                                this.loading = false;\n                                callback && callback();\n                            }\n                        });\n                    }else {\n                        if(total_money > 0) {\n                            transferallout(this.productId).then(() => {\n                                this.loading = false;\n                                callback && callback();\n                            })\n                        }else {\n                            this.loading = false;\n                            callback && callback();\n                        }\n                    }\n\n                }else {\n                    this.$message.error(json.info);\n                    this.loading = false;\n                    callback && callback();\n                }\n            });\n        },\n\n        getProductUrl() {\n            if(this.user) {\n\n            }\n\n            const data = {\n                product_id: this.productId,\n                gameversion: 2,\n                orientation: 2,\n                game_type: this.gameType,\n            }\n\n            if(this.loading) return ;\n            this.loading = true;\n            getUrl(data).then(json => {\n                this.loading = false;\n\t\t\t\tif (json.code == 200) {\n                    if(this.productId == 6) {\n                        if(this.app.isApp && this.app.isIOS) {\n                            window.location.href = json.list.login_url;\n                        }else {\n                            this.url = json.list.login_url.replace('http://', '//');\n                        }\n                    }else {\n                        window.location.href = json.list.login_url;\n                    }\n\t\t\t\t} else {\n\t\t\t\t    this.errorMsg = json.info;\n\t\t\t\t// \tthis.$message.error(json.info);\n\t\t\t\t}\n\t\t\t});\n        },\n        \n\n        getProductTryUrl() {\n            \n            const data = {\n                product_id: this.productId,\n                game_type: this.gameType,\n                gameversion: 2,\n                orientation: 2,\n            };\n\n            this.loading = true;\n            getTryUrl(data).then(json => {\n                this.loading = false;\n                if (json.code == 200) {\n                    if(this.productId == 6) {\n                        this.url = json.list.login_url.replace('http://', '//');\n                    }else {\n                        if(json.list.username || json.list.password) {\n                            this.tryUsername = json.list.username;\n                            this.tryPwd = json.list.password;\n                            this.tryUrl = json.list.login_url;\n                        }else {\n                            window.location.href = json.list.login_url;   \n                        }\n                    }\n                } else {\n                    this.errorMsg = (json.info);\n                }\n            });\n        },\n        \n    }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped lang=\"scss\">\n\n.product_redirect {\n    position: fixed;\n    left: 0;\n    right: 0;\n    top: 0;\n    bottom: 0;\n\n    &.url {\n        position: static;\n        height: 100%;\n    }\n\n\t.frame {\n\t\twidth: 100%;\n\t    height: 100%;\n\t    overflow-x: hidden;\n\t    margin: 0;\n\t    padding: 0;\n        border: none;\n    }\n    \n    .try_text, .error_msg {\n        text-align: center;\n        position: absolute;\n        top: 50%;\n        width: 100%;\n        transform: translateY(-50%);\n        font-size: 18px;\n    }\n    \n    .error_msg {\n        color: red;\n        padding: 0 30px;\n    }\n}\n\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Redirect.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Redirect.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Redirect.vue?vue&type=template&id=48970333&scoped=true&\"\nimport script from \"./Redirect.vue?vue&type=script&lang=js&\"\nexport * from \"./Redirect.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Redirect.vue?vue&type=style&index=0&id=48970333&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"48970333\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}